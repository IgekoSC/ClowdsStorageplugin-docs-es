<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">

	<title>Anexo2 - My Docs</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="..">My Docs</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="..">Home</a>
                    </li>
                
                
                
                    <li >
                        <a href="../Advertencia/">Advertencia</a>
                    </li>
                
                
                
                    <li >
                        <a href="../Anexo1/">Anexo1</a>
                    </li>
                
                
                
                    <li class="active">
                        <a href="./">Anexo2</a>
                    </li>
                
                
                
                    <li >
                        <a href="../Lista-de-funciones/">Lista de funciones</a>
                    </li>
                
                
                </ul>
            

            
            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                
                <li >
                    <a rel="next" href="../Anexo1/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../Lista-de-funciones/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                
            </ul>
            
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#anexo-2-clase-principal-campos-y-metodos-utiles">Anexo 2. Clase principal: campos y métodos útiles</a></li>
        
            <li><a href="#qstring-accesstoken">QString accessToken</a></li>
        
            <li><a href="#qstring-nextchanges">QString nextChanges</a></li>
        
            <li><a href="#qhash-qstring-change62-allevents">QHash QString, Change> allEvents</a></li>
        
            <li><a href="#qhashqstring-qmapuint-change62-62-mychanges">QHashQString, QMapuint, Change> > myChanges</a></li>
        
            <li><a href="#qhashqstring-file62-filesbyid">QHashQString, File> filesById</a></li>
        
            <li><a href="#qhashqstring-file62-filesbypath">QHashQString, File> filesByPath</a></li>
        
            <li><a href="#qhash-clowdschanges">QHash > ClowdsChanges</a></li>
        
            <li><a href="#qhash-clowdschangesbyid">QHash > ClowdsChangesById</a></li>
        
            <li><a href="#bool-updateparentsoffile-file">bool updateParentsOf(File file)</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="anexo-2-clase-principal-campos-y-metodos-utiles">Anexo 2. Clase principal: campos y métodos útiles</h1>
<p><em>Nada de lo descrito en este Anexo es obligatorio para el funcionamiento de un Plug-in para Clowds. Son recomendaciones para facilitar su desarrollo.</em></p>
<p><em>Se sugiere que el nombre de la clase principal guarde relación con el nombre del servicio que se va a implementar. De aquí en adelante la llamaremos myCloud.</em></p>
<h3 id="qstring-accesstoken">QString accessToken</h3>
<p><strong>Access Token</strong></p>
<p>En caso de utilizar OAuth2, puede ser útil guardar en esta variable el access token, ya que lo más normal es que tengas que introducirlo en cada petición HTTP para la autorización.</p>
<h3 id="qstring-nextchanges">QString nextChanges</h3>
<p><strong>Marcador de eventos</strong></p>
<p>Generalmente el servicio debe ponernos a disposición alguna forma de recibir los cambios desde un punto en concreto. En esta variable debemos guardar cada vez que hay cambios la última posición de los mismos, para tener un orden. Este valor debe registrarse además en la base de datos para guardar la posición al cerrar el programa y la volvemos a recuperar de la base de datos al iniciar de nuevo el programa.</p>
<p><code>resources_-&gt;settingsSetValue(QString key, QString value);</code></p>
<h3 id="qhash-qstring-change62-allevents">QHash &lt;QString, Change> allEvents</h3>
<p><strong>Lista de todos los eventos</strong></p>
<p>En esta lista se almacenarán temporalmente (sin importar su contenido) todos los cambios que reciba Clowds en cada llamada a getChanges().</p>
<ul>
<li>Clave: ID del evento.</li>
<li>Valor: Objeto Change, con el QJsonObject entero del evento.</li>
</ul>
<h3 id="qhashqstring-qmapuint-change62-62-mychanges">QHash&lt;QString, QMap&lt;uint, Change> > myChanges</h3>
<p><strong>Lista de todos los cambios por cada archivo</strong></p>
<p>Este QHash es el que retorna getChanges(). De todos los eventos de allEvents, solo se insertarán en myChanges aquellos eventos que sean cambios válidos para Clowds (Insertar, modificar, borrar, mover, restaurar de la papelera…). Eventos como marcar un archivo como favorito, añadir o quitar etiquetas, son eventos inservibles para Clowds.</p>
<p>Guardará de cada archivo, un QMap con todos sus cambios, indexados por fecha (recomendable UNIX Time Stamp) para ordenarlos cronológicamente.</p>
<p>Clave: ID del archivo.
Valor: QMap<uint, Change><br />
{ 
Clave: Fecha (UNIX Time Stamp).
Valor: Objeto Change.
}.</p>
<h3 id="qhashqstring-file62-filesbyid">QHash&lt;QString, File> filesById</h3>
<p><strong>Lista de archivos indexada por ID</strong></p>
<p>En este QHash se irán insertando los archivos que se vayan descargando o creando en la nube indexados por el ID del archivo, para poder tener un registro de todos los archivos que tenemos almacenados, y así poder conseguir información de cada uno de ellos en cualquier momento. </p>
<ul>
<li>Clave: ID del archivo [File::getId()]</li>
<li>Valor: Archivo [File]</li>
</ul>
<h3 id="qhashqstring-file62-filesbypath">QHash&lt;QString, File> filesByPath</h3>
<p><strong>Lista de archivos indexada por la ruta del archivo</strong></p>
<p>En este QHash se irán insertando los archivos que se vayan descargando o creando en la nube indexados por la ruta (path) del archivo, para poder tener un registro de todos los archivos que tenemos almacenados, y así poder conseguir información de cada uno de ellos en cualquier momento. </p>
<ul>
<li>Clave: Ruta del archivo [File::getPath()]</li>
<li>Valor: Archivo [File]</li>
</ul>
<h3 id="qhash-clowdschanges">QHash<QString, QList<CloudStorageChange\> > ClowdsChanges</h3>
<p><strong>Lista de los cambios que se harán efectivos</strong></p>
<p>Este QHash es el que devolveremos en getChanges() al finalizar de procesar todos los cambios que encuentre Clowds.</p>
<ul>
<li>Clave: Ruta del archivo que sufre el cambio.</li>
<li>Valor: Objeto CloudStorageChange. </li>
</ul>
<h3 id="qhash-clowdschangesbyid">QHash<QString, QList<CloudStorageChange\> > ClowdsChangesById</h3>
<p><strong>Lista de los cambios que se harán efectivos indexada por ID</strong></p>
<p>Este QHash es igual que ClowdsChanges, salvo que está indexado por ID del archivo. Esto sirve para evitar conflictos en caso de que se repitan las rutas, debido a que ClowdsChanges va indexado por la ruta del archivo (Podrían solaparse o anularse los cambios, así como repetirse archivos, y otras situaciones).</p>
<ul>
<li>Clave: ID del archivo que sufre el cambio.</li>
<li>Valor: Objeto CloudStorageChange.</li>
</ul>
<h3 id="bool-updateparentsoffile-file">bool updateParentsOf(File &amp;file)</h3>
<p><strong>Construye el path en local mediante el id y el parent id del 'file' que recibe</strong></p>
<p>Esta función se usa en caso de que el servicio no dé información acerca del path o el path no esté como Clowds lo pide. Por cada 'file' que reciba esta función lo que hace es construir el path del 'file' mediante el id y el parent id, todo ello en un bucle que va obteniendo el nombre (title) de dicho id y el del parent id hasta llegar a root que en ese punto se sale del bucle. </p>
<p>El resultado lo va insertando en el path de dicho 'file' y una vez obtenido, en filesByPath inserta el path y el 'file' y devuelve 'true' si la operación se ha hecho correctamente, por lo contrario 'false'.</p>
<ul>
<li>Párametro: Objeto File.</li>
</ul></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script src="../js/base.js"></script>

        <!--
        MkDocs version  : 0.12.2
        Docs Build Date : 2015-05-04 13:39:05.260599
        -->
    </body>
</html>